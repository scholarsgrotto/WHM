<html>
	<head>
	
	<!-- Data visualization produced by Daniel Johnson ( http://orcid.org/0000-0003-1976-0635 ) in the CDS of the Hesburgh Library, University of Notre Dame, December 2017. Based on data generated by English graduate students, especially Anton Povzner and his team. This visualization is free for use, but is not the work of professional programmers and is not warranted in any way; use at your own risk -->
	
	<title>Western Home Monthly Topic Models</title>
	
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart', 'controls']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);
	  
	  var chart;
	  var chartOptions = {};
	  var columns = [];
      var series = {};
	  var view;

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      
      function drawChart() {

        // Create the data table.
        // var data = new google.visualization.DataTable();        
        var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1LsIJVj4iC9IC56vc9d4D81hi3XrHh0M_KRVzDIKCA-A/gviz/tq?range=A1:AO33');
        
       // query.setQuery('select A, sum(B) group by B');
        var test = 'test'
        var myData = query.send(handleQueryResponse);
        
                
        function handleQueryResponse(response) {
      
        	if (response.isError()) {
            alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
            return;
          }
          
          // Get our dataset
          dataset = response.getDataTable();

          // Set chart options
          chartOptions = {
						//legend: { position: 'top', alignment: 'end' }
						'title':'WHM Visualized',
                        'width':1600,
                        'height':800,
						series: series,
						legend: { position: 'top', maxLines: 6, textStyle: {fontSize: 15} },
                        hAxis: {
							title: 'Year',
							//Removes comma
							format: '0'
                        },
                        vAxis: {
							title: 'Topic Proportion',
							//scaleType: 'log',
							ticks: [0, .02, .04, .06, .08, .1, .12],
							format: 'percent'
                        }
			};

          chart = new google.visualization.LineChart(document.getElementById('chart_div'));
          //chart.draw(dataset, {width: 600, height: 440, title:'test'});
          chart.draw(dataset, chartOptions);
          
          // Some code adapted from http://jsfiddle.net/xDUPF/53/
          
          for (var i = 0; i < dataset.getNumberOfColumns(); i++) {
              columns.push(i);
              if (i > 0) {
                  series[i - 1] = {};
              }
          }
          
          

          // Add a listener for user clicks
          google.visualization.events.addListener(chart, 'select', function () {
            	
			
            var selectedItem = chart.getSelection();

						// This loop code adapted from: http://jsfiddle.net/xDUPF/53/
             
            if (selectedItem.length > 0) {
            
              // if row is undefined, we clicked on the legend
              if (selectedItem[0].row === null) {
                  var col = selectedItem[0].column;
                  
                  if (columns[col] == col) {
                      // hide the data series
					                       
                      columns[col] = {
                          label: dataset.getColumnLabel(col),
                          type: dataset.getColumnType(col),
                          calc: function () {
                              return null;
                          }
                      
                      };
                      
					
                      // grey out the legend entry
                      series[col - 1].color = '#CCCCCC';
					  
                      
                  }
                  else {
                      // show the data series
                      columns[col] = col;
                      series[col - 1].color = null;
					  //alert(columns[col] + " " + col);
					  					  
					  
                  }
                  
                  
                  view = new google.visualization.DataView(dataset);
                  
                  view.setColumns(columns);
                  
                  chart.draw(view, chartOptions);
				  
                  
              	}
          		

          	}
                  
 
        	});
        
		
      	} // End of handleQueryResponse

		
         
        } // End of drawChart	

		
		function deselectAll (){		
			
			for (var j = 0; j < (dataset.getNumberOfColumns() - 1); j++) {
			
							
					//BUT THIS WORKS!:
					columns[j+1] = {
					//columns[j] = {
					  label: dataset.getColumnLabel(j+1),
					  type: dataset.getColumnType(j+1),
					  calc: function () {
						  return null;
					  }
				
					};
					
					
					// grey out the legend entry
                    series[j].color = '#CCCCCC';	
				
				  
		
			}
			
			
			view = new google.visualization.DataView(dataset);
			
			           
			view.setColumns(columns);
						
					
			chart.draw(view, chartOptions);	
			
				
         
			//columns = newColumns;
			//series = newSeries;
			
			
			} // End of deselectAll 
      
      
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    
	<div>
	<div id="chart_div"></div>
	<div style="text-align: center;"><input type="button" Value="Clear All" onclick="deselectAll()" style="width:120px;height:70px;font-size:22px; "></div>
	</div>
	
  </body>
</html>